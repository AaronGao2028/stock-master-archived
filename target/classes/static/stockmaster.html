<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400&display=swap">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.ico">
    <title>Stock Master - Build Your Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header>
    <h1 style = "font-size: 2.5vw;">Stock Master</h1>
    <p style = "font-size: 1.5vw;">Build Your Portfolio</p>
</header>

<div class="content-container" style="min-height: 100vh;">
    <div class="form-container">
        <div class="quotation">
            "Your Pathway to Profits: Crafting Portfolios with Precision."
        </div>
    
        <form id="nameCollector" class="input-form" action="JavaScript:processName()" style = "font-size: 1.5vw;">
            <div class="form-group">
                <label for="firstName">First Name:</label>
                <input type="text" id="firstName" name="name" class="form-input" required>
            </div>
    
            <div class="form-group">
                <label for="lastName">Last Name:</label>
                <input type="text" id="lastName" name="email" class="form-input" required>
            </div>
    
            <button type="submit" class="form-button">NEXT</button>
        </form>
    </div>

    <div style="font-size: 2vw">
        <p id="d0Result"></p>
    </div>

    <div id="d1" style="display: none; font-size: 1.5vw;">
        <form id="sectorForm" class="input-form">
            <div class="form-group">
                <label>Select sectors you are interested in:</label><br>
                <input type="checkbox" name="sector" value="Financial Services">Financial Services<br>
                <input type="checkbox" name="sector" value="Basic Materials">Basic Materials<br>
                <input type="checkbox" name="sector" value="Technology">Technology<br>
                <input type="checkbox" name="sector" value="Communication Services">Communication Services<br>
                <input type="checkbox" name="sector" value="Utilities">Utilities<br>
                <input type="checkbox" name="sector" value="Energy">Energy<br>
                <input type="checkbox" name="sector" value="Real Estate">Real Estate<br>
                <input type="checkbox" name="sector" value="Healthcare">Healthcare<br>
                <input type="checkbox" name="sector" value="Industrials">Industrials<br>
                <input type="checkbox" name="sector" value="Consumer Defensive">Consumer Defensive<br>
                <input type="checkbox" name="sector" value="Consumer Cyclical">Consumer Cyclical<br>
            </div>
        
            <div class="form-group">
                <label>Select market cap size you are interested in:</label><br>
                <input type="checkbox" name="marketCap" value="nano cap">Nano Cap ($0 - $50 million)<br>
                <input type="checkbox" name="marketCap" value="micro cap">Micro Cap ($50 million - $300 million)<br>
                <input type="checkbox" name="marketCap" value="small cap">Small Cap ($300 million - $2 billion)<br>
                <input type="checkbox" name="marketCap" value="mid cap">Mid Cap ($2 billion - $10 billion)<br>
                <input type="checkbox" name="marketCap" value="large cap">Large Cap ($10 billion - $200 billion)<br>
                <input type="checkbox" name="marketCap" value="mega cap">Mega Cap ($200 billion or more) <br>
            </div>
        
            <div class="form-group">
                <label>Select dividend yield range you are interested in:</label><br>
                <input type="checkbox" name="dividend" value="no dividend">No Dividend (0%)<br>
                <input type="checkbox" name="dividend" value="low dividend">Low Dividend Yield (0.5% - 2%)<br>
                <input type="checkbox" name="dividend" value="moderate dividend">Moderate Dividend Yield (2% - 4%)<br>
                <input type="checkbox" name="dividend" value="high dividend">High Dividend Yield (4% - 6%)<br>
                <input type="checkbox" name="dividend" value="ultra high dividend">Ultra High Dividend Yield (6% or more)<br>
            </div>
        
            <div class="form-group">
                <label>How many stocks would you like in your portfolio:</label><br>
                <input type="radio" name="numStocks" value="10">Concentrated Portfolio (10 Stocks)<br>
                <input type="radio" name="numStocks" value="25">Moderate Portfolio (25 Stocks)<br>
                <input type="radio" name="numStocks" value="50">Diversified Portfolio (50 Stocks)<br>
                <input type="radio" name="numStocks" value="100">Very Diversified Portfolio (100 Stocks)<br>
            </div>
        
            <button type="submit" class="form-button">GENERATE PORTFOLIO</button>
        </form>
        
        
    </div>

   <div id = "toggleSector" style = "display: none;">
         <button class = "toggleButton" id = "toggleSectorButton" onclick = "toggleSectorAllocationChart()">Hide Sector Allocation Chart</button>
    </div>
   
    <div id = "sectorAllocationChart" style="font-size: 1.5vw; text-align: center;">
        <p style="font-size: 2.5vw; font-weight: bold; color: #333;" id="sectorPieChartTitle"></p>
  
        <canvas id="sectorPieChart" style="margin: auto; width: 40vw;"></canvas>
    </div>

    <div id = "toggleMarketCap" style = "display: none;">
        <button class = "toggleButton" id = "toggleMarketCapButton" onclick = "toggleMarketCapAllocationChart()">Hide Market Cap Allocation Chart</button>
   </div>

    <div id = "marketCapAllocationChart" style = "font-size: 1.5vw; text-align: center;">
        <p style="font-size: 2.5vw; font-weight: bold; color: #333;" id="marketCapAllocationPieChartTitle"></p>

        <canvas id = "marketCapAllocationPieChart" style = "margin: auto; width: 40vw;"></canvas>
    </div>

    <div id = "toggleDividend" style = "display: none;">
        <button class = "toggleButton" id = "toggleDividendButton" onclick = "toggleDividendAllocationChart()">Hide Dividend Allocation Chart</button>
   </div>

    <div id = "dividendAllocationChart" style = "font-size: 1.5vw; text-align: center;">
        <p style="font-size: 2.5vw; font-weight: bold; color: #333;" id="dividendAllocationPieChartTitle"></p>

        <canvas id = "dividendAllocationPieChart" style = "margin: auto; width: 40vw"></canvas>
    </div>
    
    <div id = "toggleStockList" style = "display: none; text-align: center;">
        <button style = "margin: auto;" class = "toggleButton" id = "toggleStockListButton" onclick = "toggleStockList()">Hide Stock Portfolio</button>
   </div>

    <div id = "stockList" style="font-size: 1.5vw; width: 80vw;">
        <div id="dataContainer">
            <!-- Generated data will be inserted here dynamically -->
        </div>
    </div>

</div>

<footer style = "font-size: 1.5vw;">
    &copy; 2023 Stock Master. All rights reserved.
</footer>

</body>

<script>
    function toggleSectorAllocationChart(){
        const sectorAllocationChart = document.getElementById("sectorAllocationChart");

        if (sectorAllocationChart.style.display == "none"){
            sectorAllocationChart.style.display = "block";
            document.getElementById("toggleSectorButton").innerHTML = "Hide Sector Allocation Chart";
        } else {
            sectorAllocationChart.style.display = "none";
            document.getElementById("toggleSectorButton").innerHTML = "Show Sector Allocation Chart";
        }
    }

    function toggleMarketCapAllocationChart(){
        const marketCapAllocationChart = document.getElementById("marketCapAllocationChart");

        if (marketCapAllocationChart.style.display == "none"){
            marketCapAllocationChart.style.display = "block";
            document.getElementById("toggleMarketCapButton").innerHTML = "Hide Market Cap Allocation Chart";
        } else {
            marketCapAllocationChart.style.display = "none";
            document.getElementById("toggleMarketCapButton").innerHTML = "Show Market Cap Allocation Chart";
        }
    }

    function toggleDividendAllocationChart(){
        const dividendAllocationChart = document.getElementById("dividendAllocationChart");

        if (dividendAllocationChart.style.display == "none"){
            dividendAllocationChart.style.display = "block";
            document.getElementById("toggleDividendButton").innerHTML = "Hide Dividend Allocation Chart";
        } else {
            dividendAllocationChart.style.display = "none";
            document.getElementById("toggleDividendButton").innerHTML = "Show Dividend Allocation Chart";
        }
    }

    function toggleStockList(){
        const stockList = document.getElementById("stockList");

        if (stockList.style.display == "none"){
            stockList.style.display = "block";
            document.getElementById("toggleStockListButton").innerHTML = "Hide Stock Portfolio";
        } else {
            stockList.style.display = "none";
            document.getElementById("toggleStockListButton").innerHTML = "Show Stock Portfolio";
        }
    }


    // ... Other functions ...
    document.getElementById("sectorForm").addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission

        postStocks(event); // Call the postStocks function passing the event object
    });

    function postStocks(event) {
        event.preventDefault(); // Prevent the form from submitting

        var form = document.getElementById("sectorForm");
        const formData = new FormData(form);

        fetch('http://localhost:8080/submit-sectors', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.hasOwnProperty('goodStockAllocationList') && data.hasOwnProperty('sectorAllocationList') && data.hasOwnProperty("marketCapAllocationList")) {
                const goodStockAllocationList = data.goodStockAllocationList;
                const sectorAllocationList = data.sectorAllocationList;
                const marketCapAllocationList = data.marketCapAllocationList;
                const dividendAllocationList = data.dividendAllocationList;

                // Update the sector allocation pie chart
                updatePieChart(sectorAllocationList);

                //Update the market cap allocation pie chart
                updateMarketCapChart (marketCapAllocationList);

                //Update the dividend allocation pie chart
                updateDividendChart(dividendAllocationList);

                // Update the stock table
                updateStockTable(goodStockAllocationList);
            } else {
                document.getElementById("dataContainer").innerHTML = "An error occurred while fetching data. V1";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById("dataContainer").innerHTML = "An error occurred while fetching data. V2";
        });
    }


    let currentPieChart = null;

    function updatePieChart(sectorAllocationList) {
        document.getElementById("toggleSector").style.display = "block";
        document.getElementById('sectorPieChartTitle').innerHTML = 'Sector Allocation Chart';       

        const sectorNames = sectorAllocationList.map(item => item.sectorName); // Use 'sectorName'
        const sectorAllocations = sectorAllocationList.map(item => item.allocationPercentage); // Use 'allocationPercentage'

        const ctx = document.getElementById('sectorPieChart').getContext('2d');

        // Destroy the current pie chart instance if it exists
        if (currentPieChart) {
            currentPieChart.destroy();
        }

        currentPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: sectorNames,
                datasets: [{
                    data: sectorAllocations,
                    backgroundColor: [
                    '#FF6384', // Red
                    '#36A2EB', // Blue
                    '#FFCE56', // Yellow
                    '#4CAF50', // Green
                    '#E91E63', // Pink
                    '#9C27B0', // Purple
                    '#FF5722', // Orange
                    '#607D8B', // Gray
                    '#8BC34A', // Light Green
                    '#FF9800', // Amber
                    '#3F51B5', // Indigo
                    ],
                }],
            },
            options: {
                // Customize chart options as needed

                title: {
                    display: true,
                    text: 'Sector Allocation Percentage', // Your desired title here
                    fontSize: 16, // Font size of the title
                    fontColor: '#333', // Color of the title text
                    position: 'top', // Position of the title: 'top', 'bottom', 'left', 'right'
                },
            },
        });
    }

    let marketCapAllocationPieChart = null;

    function updateMarketCapChart(marketCapAllocationList) {
        document.getElementById("marketCapAllocationPieChartTitle").innerHTML = "Market Cap Allocation Chart";
        document.getElementById("toggleMarketCap").style.display = "block";

        const marketCapName = marketCapAllocationList.map(item => item.marketCapName); // Use 'sectorName'
        const marketCapAllocation = marketCapAllocationList.map(item => item.allocationPercentage); // Use 'allocationPercentage'

        const ctx = document.getElementById('marketCapAllocationPieChart').getContext('2d');

        // Destroy the current pie chart instance if it exists
        if (marketCapAllocationPieChart) {
            marketCapAllocationPieChart.destroy();
        }

        marketCapAllocationPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: marketCapName,
                datasets: [{
                    data: marketCapAllocation,
                    backgroundColor: [
                    '#FF6384', // Red
                    '#36A2EB', // Blue
                    '#FFCE56', // Yellow
                    '#4CAF50', // Green
                    '#E91E63', // Pink
                    '#9C27B0', // Purple
                    '#FF5722', // Orange
                    '#607D8B', // Gray
                    '#8BC34A', // Light Green
                    '#FF9800', // Amber
                    '#3F51B5', // Indigo
                    ],
                }],
            },
            options: {
                title: {
                    display: true,
                    text: 'Sector Allocation Percentage', // Your desired title here
                    fontSize: 18,
                    fontColor: '#333',
                },
            // Customize other chart options as needed
            },
        });
    }

    let dividendAllocationPieChart = null;

    function updateDividendChart(dividendAllocationList) {
        document.getElementById("dividendAllocationPieChartTitle").innerHTML = "Dividend Allocation Chart";
        document.getElementById("toggleDividend").style.display = "block";

        const dividendName = dividendAllocationList.map(item => item.dividendName); // Use 'sectorName'
        const dividendAllocation = dividendAllocationList.map(item => item.allocationPercentage); // Use 'allocationPercentage'

        const ctx = document.getElementById('dividendAllocationPieChart').getContext('2d');

        // Destroy the current pie chart instance if it exists
        if (dividendAllocationPieChart) {
            dividendAllocationPieChart.destroy();
        }

        dividendAllocationPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: dividendName,
                datasets: [{
                    data: dividendAllocation,
                    backgroundColor: [
                    '#FF6384', // Red
                    '#36A2EB', // Blue
                    '#FFCE56', // Yellow
                    '#4CAF50', // Green
                    '#E91E63', // Pink
                    '#9C27B0', // Purple
                    '#FF5722', // Orange
                    '#607D8B', // Gray
                    '#8BC34A', // Light Green
                    '#FF9800', // Amber
                    '#3F51B5', // Indigo
                    ],
                }],
            },
            options: {
                title: {
                    display: true,
                    text: 'Sector Allocation Percentage', // Your desired title here
                    fontSize: 18,
                    fontColor: '#333',
                },
            // Customize other chart options as needed
            },
        });
    }

    function updateStockTable(goodStockAllocationList) {
        document.getElementById("toggleStockList").style.display = "block";
        
        let markup = `
            <table class="stock-table">
                <tr>
                    <th>Ticker</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Market Cap</th>
                    <th>Dividend</th>
                    <th>Sector</th>
                    <th>Allocation</th>
                </tr>
        `;

        goodStockAllocationList.forEach(stockAllocation => {
            const stock = stockAllocation.stock;
            markup += `
                <tr>
                    <td>${stock.ticker}</td>
                    <td>${stock.name}</td>
                    <td>$${stock.price}</td>
                    <td>${stock.marketCap}B</td>
                    <td>${stock.dividend}%</td>
                    <td>${stock.sector}</td>
                    <td>${stockAllocation.allocation}%</td>
                </tr>
            `;
        });

        markup += `</table>`;

        document.getElementById("dataContainer").innerHTML = markup;
    }




    function getStocks(){
        fetch('http://localhost:8080/api/v1/stock')
        .then(res => {
            return  res.json();
        })
        .then(data => {
            let markup = "";
            data.forEach(user => {
                markup += `<li>${user.name}</li>`;

                document.getElementById("poster").innerHTML = markup;
            });
        })
        .catch(error => console.log(error));
    }

    function processName() {
        var form = document.getElementById("nameCollector");
        var firstName=form.elements[0].value;
        var lastName=form.elements[1].value;
        var text="Hello " + firstName + " " + lastName + "!";

        document.getElementById("d0Result").innerHTML=text;
        document.getElementById("d1").style.display="block";
    }
</script>

</html>
